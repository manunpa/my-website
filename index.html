<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Stations Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body, html, #app {
      height: 100%;
      margin: 0;
      background: linear-gradient(135deg, #0f0f2f, #1a1a2e);
      color: #00ffff;
      font-family: 'Courier New', monospace;
    }
    #map {
      height: 100%;
      border-radius: 0 0 0.5rem 0;
      box-shadow: 0 0 15px #00ffffaa;
    }
    /* custom scrollbar for left panel */
    #leftPanel::-webkit-scrollbar {
      width: 8px;
    }
    #leftPanel::-webkit-scrollbar-thumb {
      background-color: #00ffffaa;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="app" class="flex flex-col h-full">
    <!-- Top menu -->
    <header class="flex items-center justify-between bg-[#001F3F] px-6 py-3 shadow-md">
      <div class="text-xl font-semibold tracking-wide">üõ∞Ô∏è Customer Stations Map</div>
      <nav class="space-x-6 text-cyan-300">
        <button class="hover:text-cyan-100 transition">Home</button>
        <button class="hover:text-cyan-100 transition">Fleet</button>
        <button class="hover:text-cyan-100 transition">Settings</button>
      </nav>
    </header>

    <!-- Main content -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Left panel: Vehicle list -->
      <aside id="leftPanel" class="w-72 bg-[#002244] p-4 overflow-y-auto border-r border-cyan-600 flex flex-col">
        <h2 class="mb-4 font-bold text-cyan-300 text-lg">üöó Station List</h2>
        <input 
          type="text" 
          id="searchInput" 
          placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ..." 
          class="mb-4 p-2 rounded bg-[#003355] text-cyan-100 placeholder-cyan-400 focus:outline-none focus:ring-2 focus:ring-cyan-400"
        />
        <ul id="vehicleList" class="space-y-3 overflow-y-auto flex-1">
          <!-- JS will inject list here -->
        </ul>
      </aside>

      <!-- Right panel: Map -->
      <main class="flex-1 relative flex flex-col">
        <div class="p-2 bg-[#001F3F] text-cyan-300 flex items-center space-x-3 border-b border-cyan-600">
          <label for="layerSelect" class="font-semibold select-none">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà:</label>
          <select id="layerSelect" class="bg-[#003355] text-cyan-200 rounded px-2 py-1 focus:outline-none">
            <option value="osm">OpenStreetMap</option>
            <option value="satellite">‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°</option>
          </select>
        </div>
        <div id="map" class="flex-1"></div>
      </main>
    </div>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  
  <script>
    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ (‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å CSV)
    let vehicles = [];

    // ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡∏à‡∏≤‡∏Å path 'data/stations.csv'
    async function loadCSV() {
      const response = await fetch('data/stations.csv');
      const csvText = await response.text();
      const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
      vehicles = parsed.data.map(row => ({
        name: row.name || row.Name || row.NAME,
        lat: parseFloat(row.lat || row.Lat || row.LAT),
        lng: parseFloat(row.lng || row.Lng || row.LNG)
      })).filter(v => v.name && !isNaN(v.lat) && !isNaN(v.lng));
      displayVehicles();
    }

    // Initialize map
    const map = L.map('map').setView([13.7563, 100.5018], 13);

    // Base layers
    const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    });

    const satelliteLayer = L.tileLayer(
      'https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      subdomains:['mt0','mt1','mt2','mt3'],
      attribution: '¬© Google Satellite',
      maxZoom: 20
    });

    osmLayer.addTo(map);

    // Layer switcher
    const layerSelect = document.getElementById('layerSelect');
    layerSelect.addEventListener('change', e => {
      if (map.hasLayer(osmLayer)) map.removeLayer(osmLayer);
      if (map.hasLayer(satelliteLayer)) map.removeLayer(satelliteLayer);
      if (e.target.value === 'osm') osmLayer.addTo(map);
      else if (e.target.value === 'satellite') satelliteLayer.addTo(map);
    });

    // Custom car icon
    const carIcon = L.icon({
      iconUrl: 'https://www.freepnglogos.com/uploads/mr-bean-png/mr-bean-bean-waving-transparent-png-stickpng-2.png',
      iconSize: [40, 40],
      iconAnchor: [20, 20],
      popupAnchor: [0, -20]
    });

    const markers = [];

    // Vehicle list DOM
    const vehicleListEl = document.getElementById('vehicleList');
    const searchInput = document.getElementById('searchInput');

    function displayVehicles(filter = '') {
      vehicleListEl.innerHTML = '';
      markers.forEach(m => map.removeLayer(m));
      markers.length = 0;

      const filtered = vehicles.filter(v => v.name.toLowerCase().includes(filter.toLowerCase()));

      filtered.forEach(v => {
        // List item
        const li = document.createElement('li');
        li.textContent = v.name;
        li.className = 'cursor-pointer px-3 py-2 rounded bg-[#003355] hover:bg-cyan-600 transition';
        li.onclick = () => {
          map.setView([v.lat, v.lng], 15, { animate: true });
          markers.forEach(m => m.closePopup());
          const found = markers.find(m => m.getLatLng().lat === v.lat && m.getLatLng().lng === v.lng);
          if (found) found.openPopup();
        };
        vehicleListEl.appendChild(li);

        // Marker
        const marker = L.marker([v.lat, v.lng], { icon: carIcon })
          .addTo(map)
          .bindPopup(`<b>${v.name}</b><br>Lat: ${v.lat.toFixed(6)}<br>Lng: ${v.lng.toFixed(6)}`)
          .bindTooltip(`Lat: ${v.lat.toFixed(6)}, Lng: ${v.lng.toFixed(6)}`);
        markers.push(marker);
      });
    }

    searchInput.addEventListener('input', e => {
      displayVehicles(e.target.value);
    });

    // ‡πÇ‡∏´‡∏•‡∏î CSV ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    loadCSV();
  </script>
</body>
</html>


